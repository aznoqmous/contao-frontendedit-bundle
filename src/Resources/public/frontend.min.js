!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);class i{constructor(e){this.element=e,this.type=this.getType(),this.id=this.getId(),this.settingsPane=null}setSettingsPane(e){this.settingsPane=e}getId(){let e=this.element.className.match(/ce_(\d{1,})/);return e?e[1]:null}getType(){let e=null;return this.element.className.match(/ce_/)&&(e="tl_content"),this.element.className.match(/mod_/)&&(e="tl_module"),e}updateContent(e,t=!1){let n=document.createElement("div");n.innerHTML=e;let i=n.querySelector("*");return i.classList.add("editable"),i.classList.add("active"),t||i.classList.add("unsaved"),i.classList.add("ce_"+this.id),this.element.parentElement.insertBefore(i,this.element),this.element.remove(),this.element=i,i}save(){let e=new FormData(this.settingsPane.querySelector("form"));fetch(this.getContentPopupUrl(),{method:"POST",body:e}).then(e=>e.text()).then(e=>{this.updateSettingsColumn(e)}),this.updateElement(e,!0)}getContentPopupUrl(){return"tl_content"===this.type?`/contao?do=article&table=tl_content&id=${this.id}&popup=1&act=edit&rt=${l.rt}`:null}updateElement(e){return this.fetchContentElementHtml(e).then(e=>{this.updateContent(e)})}fetchContentElementHtml(e){return fetch("/api/frontendedit/render/"+this.id,{method:"POST",body:e}).then(e=>e.json())}updateSettingsColumn(){return fetch(this.getContentPopupUrl()).then(e=>e.text()).then(e=>{this.settingsPane.innerHTML=e,setTimeout(()=>{let e=this.settingsPane.querySelector(".split-button");e.parentElement.removeChild(e),[...this.settingsPane.querySelectorAll("tl_box")].map(e=>e.classList.add("collapsed"));let t=this.settingsPane.querySelector("form#tl_content");this.settingsPane.innerHTML="",this.settingsPane.appendChild(t),t.addEventListener("submit",e=>{e.preventDefault(),this.save()}),[...t.querySelectorAll("input,select,textarea,checkbox,radio")].map(e=>e.addEventListener("change",()=>{let e=new FormData(t);this.updateElement(e,!1)}))},10)})}}class s{static getAll(){let e=document.cookie;if(!e)return{};let t={};return e.split(";").map(e=>{let n=e.split("="),i=n[0].trim().replace(/\"/gs,""),s=n[1];return t[i]=s}),t}static get(e){let t=s.getAll()[e];return t?JSON.parse(t):null}static set(e,t,n=864e12,i=null){let s=`${e}=${JSON.stringify(t)};expires=${new Date(n).toUTCString()}`;i&&(s+=";path="+i),document.cookie=s}}class l{constructor(){return window.parent!==window?null:(this.edit=s.get("frontendedit"),this.edit?(this.rt=null,this.iframe=null,this.settingsColumn=null,this.getToken().then(e=>{console.log(this.rt),e&&this.build()}),void(this.editables=[])):this.buildToggleFrontendEdit())}static get rt(){return window._rt}static set rt(e){window._rt=e}get rt(){return window._rt}set rt(e){window._rt=e}build(){this.iframe=document.createElement("iframe");let e=new URLSearchParams(window.location.search);e.append("frontendedit",1),document.body.innerHTML="",document.body.style.padding=0,document.body.style.margin=0,document.body.style.display="flex",this.iframe.src=window.location.origin+""+window.location.pathname+"?"+e.toString(),this.iframe.style.width="70vw",this.iframe.style.height="100vh",document.body.appendChild(this.iframe),this.settingsColumn=document.createElement("div"),this.settingsColumn.style.width="30vw",document.body.appendChild(this.settingsColumn),this.addStyleSheets(),this.iframe.onload=()=>{this.bindIframe()},this.buildToggleFrontendEdit()}buildToggleFrontendEdit(){let e=document.createElement("div");e.innerHTML=this.edit?"View":"Edit",e.addEventListener("click",()=>{s.set("frontendedit",!this.edit),window.location.reload()}),e.style.position="fixed",e.style.left=0,e.style.top=0,e.style.padding="10px",e.style.background="white",e.style.zIndex=1e4,e.style.cursor="pointer",document.body.appendChild(e)}addStyleSheets(){[...document.querySelectorAll("link[href],style")].map(e=>e.remove());["system/themes/flexible/basic.min.css"].map(e=>{let t=document.createElement("link");t.rel="stylesheet",t.href=e,document.head.appendChild(t)})}getToken(){return fetch("/api/frontendedit/token").then(e=>e.json()).then(e=>!!e&&(this.rt=e,!0))}getIframeContentElements(){return[...this.iframe.contentDocument.body.querySelectorAll(".editable")]}bindEditable(e){this.bindIframeContentElement(e)}bindIframeContentElement(e){e.element.addEventListener("mouseenter",t=>{this.getIframeContentElements().map(e=>e.classList.remove("hover")),e.element.classList.add("hover")}),e.element.addEventListener("mouseleave",t=>{e.element.classList.remove("hover")}),e.element.addEventListener("click",t=>{if(e.element!==t.currentTarget)return null;this.getIframeContentElements().map(e=>e.classList.remove("active")),e.element.classList.add("active"),this.openEditableSettings(e)}),[...e.element.querySelectorAll("a[href]")].map(e=>{e.addEventListener("click",t=>{t.preventDefault(),window.location.href=e.href})})}bindIframe(){[...this.iframe.contentDocument.querySelectorAll("a[href]")].map(e=>{e.addEventListener("click",t=>{t.preventDefault(),window.location.href=e.href})}),this.getIframeContentElements().map(e=>{let t=new i(e);this.editables.push(t),this.bindEditable(t)})}openEditableSettings(e){[...this.settingsColumn.children].map(e=>e.style.display="none"),e.settingsPane||(e.settingsPane=document.createElement("div"),this.settingsColumn.appendChild(e.settingsPane),e.updateSettingsColumn()),e.settingsPane.style.display="block"}}document.addEventListener("DOMContentLoaded",()=>{new URLSearchParams(window.location.search).get("frontendedit")?document.body.classList.add("frontendedit"):new l})}]);